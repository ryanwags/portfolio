## What's in this folder?
Here you'll find files that represent some of the data modeling work I've done in dbt. Rather than make you navigate the traditional dbt folder structure, I've adjusted the prefixes on the files to indicate their purpose.

- [`macro__remove_soft_deletes.sql`](https://github.com/ryanwags/portfolio/blob/main/dbt/macro__remove_soft_deletes.sql): This macro uses Jinja to reference dbt's graph context variable to find any source tables that have a 'soft delete' column, and deletes any records from those files that have been marked as soft deleted (likely by an ETL provider). This could be implemented using an `on-run-start` hook as part of every production run, ensuring that soft deleted records do not appear in downstream models.
- [`int__spend_stacked.sql`](https://github.com/ryanwags/portfolio/blob/main/dbt/int__spend_stacked.sql): This intermediate model demonstrates the use of Jinja as a SQL generator; the script loops over many staging models and unions them into a single model which may be referenced downstream.
- [`int__utm_events.sql`](https://github.com/ryanwags/portfolio/blob/main/dbt/int__utm_events.sql): This intermediate model summarizes UTM activity from clickstream data. A utility function from dbt-utils is used to process the referrer URL, and native SQL is used to filter out user hits from the same UTM source occurring within a 24-hour window.
- [`mart__performance_by_source.sql`](https://github.com/ryanwags/portfolio/blob/main/dbt/mart__performance_by_source.sql): This is an example of a mart model that summarizes the month-over-month performance of difference marketing sources, including KPIs such as the conversion rate from registered user to customer, cost per acquisition, etc. Because each CTE does not have a natural primary key, the script uses dbt-utils to create an MD5 hash which serves as a surrogate key for downstream joins.
---
_Copyright Â© 2023 by Ryan Wagner. All works are original and may not be copied or distributed without permission._
